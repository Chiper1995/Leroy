GiveGiftLink=function(t,i){null!=t.data("giveGiftLink")&&t.data("giveGiftLink").destroy(),this.$element=t,this.options=$.extend({},{selector:null,modalPjaxId:"",modalTitle:""},i),this.journalId=null,this.modal=this.createModal(),this.registerEvents(),t.data("giveGiftLink",this)},GiveGiftLink.prototype.destroy=function(){this.$element.off("click.giveGiftLink")},GiveGiftLink.prototype.registerEvents=function(){var i=this;null===this.options.selector?this.$element.on("click.giveGiftLink",function(t){i.handleClickEvent(t,$(this))}):this.$element.on("click.giveGiftLink",this.options.selector,function(t){i.handleClickEvent(t,$(this))})},GiveGiftLink.prototype.createModal=function(){var t=this;return new ModalPjax({url:null,pjaxId:this.options.modalPjaxId,title:this.options.modalTitle,buttons:{ok:{label:"Подарить",className:"btn-primary save-btn",callback:function(){return t.modalOkHandler(),!1}},cancel:{label:"Отмена",className:"btn-default cancel-btn"}},beforeShow:function(){t.registerModalPjaxEvents()}})},GiveGiftLink.prototype.modalOkHandler=function(){this.modal.$modal.find("#give-gift-form").submit()},GiveGiftLink.prototype.registerModalPjaxEvents=function(){var e=this,n=this.modal.$modal;n.find("#"+this.options.modalPjaxId).on("pjax:complete",function(){if(n.find("#give-gift-form-journal-id").val(e.journalId),"1"===n.find("#give-gift-form-saved").val()){var t=n.find("#give-gift-form-family-points").val(),i=n.find("#give-gift-form-journal-points").val();$(".card-info .points .caption").text(t+" баллов"),$(".view-journal-header .points .value").text(i),e.modal.hide()}})},GiveGiftLink.prototype.handleClickEvent=function(t,i){t.preventDefault(),t.stopImmediatePropagation();var e=i.attr("href");this.modal.setUrl(e),this.journalId=i.attr("data-journal-id"),this.modal.open()},null==$.fn.giveGiftLink&&($.fn.giveGiftLink=function(i){if("object"==typeof(i=i||{}))return this.each(function(){var t=$.extend(!0,{},i);new GiveGiftLink($(this),t)}),this;throw new Error("Invalid arguments for GiveGiftLink: "+i)});