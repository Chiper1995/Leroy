function Goods(e,o){var a=this;this.elementId="#"+e,this.treeViewElementId="#"+o,this.onNodeSelected=function(e,o){a.addRow(o.id,o.name)},this.onNodeUnselected=function(e,o){a.addRow(o.id,o.name)},this.getNodeById=function(e){var o=$(a.treeViewElementId).treeview("getNodes");for(var t in o)if(o[t].id==e)return o[t]},this.getCountOfId=function(e){var o=0;return $("div#journal-goods :input.goods-id").each(function(){e===$(this)[0].value&&o++}),o},this.addRow=function(e,o){var t,n=$(a.elementId);n.append('<div class="row goods goods-'+(t=n.find("div.goods").length)+'" data-id="'+e+'"></div>');var d=n.find(".goods-"+t);n.find(".goods-template").children().clone().appendTo(d);var i="goods-shop-id-"+t;d.find(".goods-name span").text(o),d.find(".goods-id").attr("name","Journal[goods]["+t+"][goods_id]").val(e),d.find(".goods-quantity").attr("name","Journal[goods]["+t+"][quantity]").val(1),d.find(".goods-price").attr("name","Journal[goods]["+t+"][price]").val(0),d.find(".goods-online").attr("name","Journal[goods]["+t+"][online]").val(1),d.find(".goods-shop-id").attr("id",i).attr("name","Journal[goods]["+t+"][goods_shop_id]").val(null),$("#"+i).on("select2:opening",initS2Open).on("select2:unselecting",initS2Unselect),jQuery.when(jQuery("#"+i).select2({allowClear:!1,theme:"bootstrap",width:"100%",placeholder:"",language:"ru"})).done(initS2Loading(i,".select2-container--bootstrap","",!0)),a.visibleHeader(),n.trigger($.Event("Goods:change"))},this.removeRow=function(e){var o=$(a.elementId);o.find("[data-id="+e+"]").html("").hide(),a.visibleHeader(),o.trigger($.Event("Goods:change"))},this.visibleHeader=function(){1<$(a.elementId).find(".goods").length?$(".goods-header").parents(".goods").show():$(".goods-header").parents(".goods").hide()},Number.prototype.formatMoney=function(e,o,t){var n=this,d=(e=isNaN(e=Math.abs(e))?2:e,o=null==o?",":o,t=null==t?" ":t,n<0?"-":""),i=parseInt(n=Math.abs(+n||0).toFixed(e))+"",a=3<(a=i.length)?a%3:0;return d+(a?i.substr(0,a)+t:"")+i.substr(a).replace(/(\d{3})(?=\d)/g,"$1"+t)+(e?o+Math.abs(n-i).toFixed(e).slice(2):"")},jQuery(document).ready(function(){var e=$("body");e.on("click",a.elementId+" .goods-duplicate",function(){var t=$(this);bootbox.dialog({message:"Дублировать этот товар?",title:"Подтверждение",buttons:{success:{label:"Да",className:"btn-primary btn-with-margin-right",callback:function(){var e=t.parents("div.goods").find(".goods-id").val(),o=a.getNodeById(e);void 0!==o&&($(a.treeViewElementId).treeview("selectNode",[o,{silent:!0}]),a.addRow(o.id,o.name))}},cancel:{label:"Отмена",className:"btn-default",callback:function(){}}}})}),e.on("click",a.elementId+" .goods-delete",function(){var n=$(this);return bootbox.dialog({message:"Удалить этот товар?",title:"Подтверждение",buttons:{success:{label:"Да",className:"btn-primary btn-with-margin-right",callback:function(){var e=n.parents("div.goods"),o=e.find(".goods-id").val(),t=a.getNodeById(o);1<a.getCountOfId(o)?(e.html("").hide(),e.trigger($.Event("Goods:change"))):void 0!==t&&($(a.treeViewElementId).treeview("unselectNode",[t,{silent:!0}]),a.removeRow(o))}},cancel:{label:"Отмена",className:"btn-default",callback:function(){}}}}),!1}),e.on("change keyup",a.elementId+" .goods-quantity, "+a.elementId+" .goods-price",function(){var e=$(this).parents(".goods"),o=e.find(".goods-price").val(),t=e.find(".goods-quantity").val();o=o.replace(" ","").replace(",","."),t=t.replace(" ","").replace(",",".");var n=(o=$.isNumeric(o)?o:0)*(t=$.isNumeric(t)?t:0);e.find(".goods-sum span").text(n.formatMoney())})})}